## 第四章容斥原理
### 4.1引论
证明方法:以此假设x是否具有各种性质,然后对等式两边分别计算贡献,如对于所有情况等式两边贡献相同则证明,等式成立(本章主要证明方法)
### 4.2 容斥原理
#### 定理4.2.1
设$A_i$为具有性质$P_i$的元素构成的集合,$\overline{A_i}$表示不具有$P_i$性质的集合,$S$为全集,则有下式,下式意义为不含性质P1,P2,...,Pm的元素个数:
$$
|\overline{A_1}\cap\overline{A_1}\cap...\cap\overline{A_m}|=|S|-\sum|A_i|+\sum|A_i\cap A_j|-...+(-1)^m|A1\cap A_2\cap ...\cap A_m|
$$ 
证明:使用引论方法进行证明

#### 推论4.2.1
设$A_i$为具有性质$P_i$的元素构成的集合,$\overline{A_i}$表示不具有$P_i$性质的集合,$S$为全集,则有下式,下式意义为至少含有性质P1,P2,...,Pm其中一个的元素个数:
$$
|A_1 \cup A_1\cup...\cup A_m|=\sum|A_i|-\sum|A_i\cap A_j|+...+(-1)^{m-1}|A1\cap A_2\cap ...\cap A_m|
$$ 

证明:与定理4.2.1互补因此|S|减去定理4.2.1即可得

#### 欧拉函数
欧拉函数$\varphi(n)$表示小于n且与n互素的整数个数

#### 图节点个数与完全子图的关系
若图G含有n个结点,且不含完全$k(k\geq2)$,则其顶点次数d(x)满足下面不等式:
$$
min(d(x))\leq \lfloor \frac{(k-2)n}{k-1} \rfloor
$$
证明:反证,从完全1子图,往完全k子图进行构造,反证假设记$\lfloor \frac{(k-2)n}{k-1} \rfloor$为p,假设对于每个顶点其最小度数为p+1.
设:
$$
(k-2)n = p(k-1)+r (0\leq r\leq k+2)
$$
令集合$|A_i|$表示与点i相邻的结点集合,首先对于单个集合$A_1$,其$|A_1|\geq p+1$(构造2完全子图),对于同时属于集合$A_1,A_2$(构造3完全子图)则有下式:
$$
\begin{aligned}
|A_1\cap A_2|&=|A_1|+|A_2|-|A_1\cup A_2|\\
&\geq (p+1) + (p+1) - n\\
&\geq 2p +2 - n
\end{aligned}
$$
PS:由于$|A_1\cup A_2|$上界一定不超过n
以此类推对于构造四子图我们有下式:
$$
\begin{aligned}
|(A_1\cap A_2) \cap A_3|&=|A_1\cap A_2|+|A3|-|(A_1\cap A_2)\cup A_3|\\
&\geq (2p+2-n) + (p+1) - n\\
&\geq 3p+3-2n
\end{aligned}
$$

一次类推我们有假设k个集合求交集$w(m)$我们有下式:
$$
w(m)=m*(p+1)-(m-1)n
$$
当w(k-1)>0时即表示至少能构造一个包含k完全子图的图.
将m=k-1带入可得原式>0,因此假设错误,原命题正确.

#### 定理 4.2.2
设集合中具有性质$P=\{P_1,P_2,...,P_m\}$中恰好r个性质的元素个数为$N(r)$
记w(k)表示从集合$|S|$中至少包含k个性质的所有方案数的和,且限定$w(0)=|S|$,如下式:
$$
w(k)=\sum_{1\leq i_1,\leq l_2\leq ... \leq i_k\leq m}N(P_{i_1},P_{i_2},...,P_{i_k})
$$

因此对于恰好有r个性质的元素个数N(r)有下式:
$$
N(r)=w(r)-\binom{r+1}{r}w(r+1)+\binom{r+2}{r}w(r+2)-...+(-1)^{m-r}\binom{m}{r}w(m)
$$

**例子:计算1到1000内不能被5,6,8整除的数**
令$P_1$能被5整除的元素,$P_2$能被6整除的元素,$P_3$能被8整除的元素个数,因此我们有:
$$
\begin{aligned}
&N(P_1)=\lfloor \frac{1000}{5}\rfloor=200\\
&N(P_2)=\lfloor \frac{1000}{6}\rfloor=166\\
&N(P_3)=\lfloor \frac{1000}{8}\rfloor=125\\
&N(P_1,P_2)=N(P_1)=\lfloor \frac{1000}{30}\rfloor=33\\
&N(P_1,P_3)=\lfloor \frac{1000}{40}\rfloor=25\\
&N(P_2,P_3)=\lfloor \frac{1000}{24}\rfloor=41\\
&N(P_1,P_2,P_3) = \lfloor \frac{1000}{120}\rfloor=8
\end{aligned}
$$
因此我们有
$$
\begin{aligned}
&w(0)=1000\\
&w(1)=200+166+125=491\\
&w(2)=33+25+41=99\\
&w(3)=8\\
\end{aligned}
$$
进而我们可以得到:
$$
\begin{aligned}
&N(0)=w(0)-w(1)+w(2)-w(3)=600\\
&N(1)=w(1)-\binom{2}{1}w(2)+\binom{3}{1}w(3)=317\\
&N(2)=w(2)-\binom{3}{2}w(3)=75
\end{aligned}
$$

### 4.3容斥原理的应用
#### 4.3.1 具有多重集合的r组合数
用于计算重数为任意给定的正整数多重集合的r组合问题(如限制a元素最多3个,b元素最多4个,c元素最多5个的10组合数)
计算方式:
先计算无重数限制多重集合r组合数$w(0)$(假设m个物品挑r个)
$$
w(0)=|S|=\binom{m+r-1}{r}
$$
定义$P_i$表示选择第i种元素超过给定重数的情况(如$P_1$表示选取a元素大于等于4个),我们假设第i中元素给定重数为$k_i$,同样是从m个物品挑r个,那么我们先选取k个,然后后面使用无限制的多重集合r组合数,因此我们可以得到下式:
$$
|A_i|=\binom{m-k_i-1}{r-k_i}\\
...\\
|A_i\cap...\cap A_j |=\binom{m-k_i-...-k_j-1}{r-k_i-...-k_j}
$$
然后计算对应w(i),最后根据题目要求输出w(ans)即可(ans即为种类数)

#### 4.3.2 错排
定义:对于1-n的一个排列a,如果对于任意$a[i]!=i$,那么我们称其为一个错排.
**定理 4.3.1**
定义$D_n$为n排列中所有错排的个数
对于任意正整数n,有下式:
$$
D_n=n![1-\frac{1}{1!}+\frac{1}{2!}-\frac{1}{3!}+...+(-1)^n\frac{1}{n!}]
$$
证明:
设$P_i$表示a[i]=i的的方案数,那么我们可以使用容斥原理算出:
$$
\begin{aligned}
D_n&=|\overline{A_1}\cap\overline{A_2}\cap...\cap\overline{A_n}|\\
&=n!-\binom{n}{1}(n-1)!+\binom{n}{2}(n-2)!-...+(-1)^n\binom{n}{n}0!\\
&=n![1-\frac{1}{1!}+\frac{1}{2!}-\frac{1}{3!}+...+(-1)^n\frac{1}{n!}]
\end{aligned}
$$

同时还有递推公式:
$$
\begin{cases}
    D_1=0\\
    D_2=1\\
    D_{n}=(n-1)*(D_{n-1}+D_{n-2})
\end{cases}
$$

前几项错排:
i|1|2|3|4|5|6|7|
---|---|---|---|---|---|---|---|
D_i|0|1|2|9|44|265|1854|

#### 4.3.3 禁止模式的排列模式
定义:设$Q_n$表示{1,2,...,n}的排列中,不出现诸如12,23,...,(n-1)n的排列数同时规定当n=1时$Q_1=1$,那么我们有下面的式子:

**定理4.3.2:** 
对任意正整数n,有:
$$
Q_n=n!-\binom{n-1}{1}(n-1)!+\binom{n-1}{2}(n-2)!-...+(-1)^{n-1}\binom{n-1}{n-1}(1)!
$$

证明:
假设$P_i$表示出现模式$i(i+1)$,那么我们可以比较容易得到下式:
$$
\sum_{i=1}^{n-1}|Ai|=\binom{n-1}{1}*(n-1)!\\
\sum_{i=1}^{n-1}\sum_{j=1,j!=i}^{n-1}|Ai\cap A_j|=\binom{n-2}{2}*(n-2)!\\
...\\
\sum|Ai\cap A_j\cap ...\cap A_n|=-1^{n-1}\binom{n-1}{n-1}1!
$$
那么我们就可以得到上式

**menage问题:**
n对夫妇参加宴会围桌就座,要求男女相间,且每对夫妇两人不得相邻,问合法方案数:
对于$n<3$可以得到答案不存在,我们讨论当$n\geq3$时:
首先我们令女士入座得到$(n-1)!$的圆排列数,对于得到的每个圆排列,我们可以得到女士中间不能放他们两人的先生,这类似错排的定义,我们定义这种问题为二重错排,n个数形成的二重错排数记为$U_n$也称(menage数),那么我们可以的得到,最终的结果数为$(n-1)!U_n$,然后我们考虑如何计算二重错排数
我们定义下面的状态$P_i$:
$$
\begin{aligned}
&P_i:a_i=i或i+1 (1\leq a_i\leq n-1)\\
&P_n:a_n=n或1
\end{aligned}
$$
那么我们可以得到不包含所有$P_i$的方案数为:
$$
U_n=w(0)-w(1)+w(2)-...+-1^nw(n)
$$
然后我们计算w(i),首先问题可以抽象为下面的形式
$$
(1,2)(2,3)...(n-1,n)(n,1)
$$
对于$w(k)$来说,相当于从上述n个括号中选取k个括号,同时要求对于相同的数不能重复选择,因此我们将括号去掉后得到下面的形式,这样我们可以将问题可以转化为从2*n个元素中选取k个元素,同时要求不能选择相邻元素的方案数:
$$
1,2,2,3,3,...,n-1,n-1,n,n,1
$$
那么我们可以得到这样的方案数为:
$$
\binom{n-k+1}{k}
$$
但是我们发现这样可能会同时选2个1,因此我们还需要将这种情况减去,假设选头尾的1之后,相当于开始的1,2以及最后的n,1已经选好了,剩下的序列中我们仍需要保证不选相邻的元素,最后对于剩下(n-k)的男士可以随意排列计算贡献,因此我们可以得到下面的最终式子:
$$
\begin{aligned}
w(k)&=[\binom{2n-k+1}{k}-\binom{2n-k-1}{k-2}]*(n-k)!\\
&=\frac{2n}{2n-k}\binom{2n-k}{k}(n-k)!
\end{aligned}
$$
因此对于$U_n$我们有下面的式子;
$$
\begin{aligned}
U_n&=w(0)-w(1)+w(2)-...+(-1)^nw(n)\\
&=n!-2n(n-1)!+...+(-1)^k\frac{2n}{2n-k}\binom{2n-k}{k}(n-k)!+...+(-1)^n2
\end{aligned}
$$

**4.3.4 实际依赖于所有变量的函数个数**
<font color=red>没看懂之后找人问一下</font>

### 4.4有限制位置的排列及棋子多项式
我们称$B$是一个棋盘,记$r_k(B)$为从B中选k个不同行不同列的阴影块的选取方法数
**定理4.4.1:** 考虑有限制位置的安排问题,设B是相应的棋盘,则安排n个不同物体的方法数为:
$$
n!-r_1(B)*(n-1)!+r_2(B)*(n-2)!-...+(-1)^nr_n(B)*0!
$$

对于一个大棋盘,我们通过将行列做适当交换,使得子棋盘$B_1,B_2$涉及行列不相交
这样对于$r_k$有:
$$
r_k(B)=\sum_{i=0}^kr_i(B_1)*r_{k-i}(B_2)
$$

**棋子多项式定义:** 由数列$\{r_0(B),r_1(B),...\}$的生成函数R(x,B)为下式:
$$
R(x,B)=\sum_{i=0}^{\infty}r_i(B)x^i
$$

那么由上述定义,由于子棋盘$B_1,B_2$不相交,因此我们可以得到下式:
$$
R(x,B)=R(x,B_1)*R(x,B_2)
$$
那么我们可以使用多项式乘积的方式通过计算小棋盘的棋盘多项式,乘积后得到大棋盘的对应$\{r_0(B),r_1(B),...\}$
**PS:对应书上例子可以对照P92页例一**

#### 例二:不能进行合理划分有限制位置排列

### 4.5莫比乌斯反演(mobius反演)
#### 莫比乌斯函数定义:
对于自然数n>1,将n进行素数划分为:
$$
n=p_1^{l_1}p_2^{l_2}...p_r^{l_r}
$$
那么定义,若n有重因子则其莫比乌斯函数值为-1,否则为0,当n为1时定义其莫比乌斯函数值为1,如下式:
$$
\mu(n)=
\begin{cases}
1 & 当n=1时 \\
0 & 存在 l_i>1\\
(-1)^r& l_1=l_2=...=l_r=1
\end{cases}
$$

**引理4.5.1:** 对于任意自然数n,有:
$$
\sum_{d|n}\mu (d)=
\begin{cases}
1 &(n=1)\\
0 &(n>1)
\end{cases}
$$
证明:对于有重因子的因子我们不用考虑(因为贡献为0),我们只考虑没有重因子的因子,我们定义$n^*$为$n$进行质因数分解后,每个质因数指数为1的数,即$n^*=p_1p_2...p_r$,那么我们从这r个质因数中每次选取k个计算贡献得:
$$
\begin{aligned}
\sum_{d|n}\mu(d)&=\sum_{d|n^*}\mu(d)\\
&=\sum_{k=0}^r-1^{k}\binom{r}{k}\\
&=(1-1)^r\\
&=0
\end{aligned}
$$

**定理4.5.1 mobius反演定理**
设$f(n),g(n)$为定义在自然数集N上的两个函数,若对任意自然数n,有
$$
\begin{aligned}
f(n)=&\sum_{d|n}g(d)\\
=&\sum_{d|n}g(\frac{n}{d})
\end{aligned}
$$
则可将g可以表示为f的加权和函数:
$$
g(n)=\sum_{d|n}\mu(d)f(\frac{n}{d})
$$

**例1 欧拉函数:**
欧拉函数满足:
$$
\varphi(n)=n\sum_{d|n}\frac{\mu(d)}{d}
$$
由mobius反演定理可得:
$$
n=\sum_{d|n}\varphi(d)=\sum_{d|n}\varphi(\frac{n}{d})
$$


**例2 可重圆排列**
